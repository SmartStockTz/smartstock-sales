import { Component, EventEmitter, Input, Output } from '@angular/core';
import { Router } from '@angular/router';
import { FormControl } from '@angular/forms';
import { debounceTime, distinctUntilChanged } from 'rxjs/operators';
import { StorageService } from '../services/storage.service';
import { UserService } from '../services/user.service';
import { SsmEvents } from '../utils/eventsNames.util';
import { EventService } from '../services/event.service';
export class ToolbarComponent {
    constructor(router, storage, userDatabase, eventService) {
        this.router = router;
        this.storage = storage;
        this.userDatabase = userDatabase;
        this.eventService = eventService;
        this.showProgress = false;
        this.hasBackRoute = false;
        this.showSearch = false;
        this.searchCallback = new EventEmitter();
        this.searchInputControl = new FormControl('');
        this.searchProgressFlag = false;
        this.isMobile = false; // environment.android;
    }
    ngOnInit() {
        this.storage.getActiveUser().then(user => {
            this.currentUser = user;
        });
        this.searchInputControl.valueChanges.pipe(debounceTime(500), distinctUntilChanged()).subscribe(_ => {
            this.searchCallback.emit(this.searchInputControl.value);
        });
        this.getProductsInCart();
        this._clearSearchInputListener();
    }
    getProductsInCart() {
        this.eventService.listen(SsmEvents.NO_OF_CART, (data) => {
            this.noOfProductsInCart = data.detail;
        });
    }
    logout() {
        this.userDatabase.logout(null).finally(() => {
            return this.router.navigateByUrl('');
        }).catch(err => console.log(''));
    }
    _clearSearchInputListener() {
        // this.eventService.listen(SsmEvents.ADD_CART, data => {
        //   this.searchInputControl.reset('');
        // });
    }
}
ToolbarComponent.decorators = [
    { type: Component, args: [{
                selector: 'smartstock-toolbar',
                template: `
    <mat-toolbar color="primary" class="sticky-top mat-elevation-z4">
      <mat-toolbar-row>
<!--        <button routerLink="{{backLink}}" *ngIf="hasBackRoute && backLink" mat-icon-button>-->
<!--          <mat-icon>arrow_back</mat-icon>-->
<!--        </button>-->
        <button mat-icon-button (click)="sidenav.toggle()">
          <mat-icon>menu</mat-icon>
        </button>
        <span>{{heading}}</span>
        <span *ngIf="isMobile" style="flex: 1 1 auto"></span>
        <span *ngIf="!isMobile && showSearch" style="width: 16px"></span>
        <span *ngIf="!isMobile && !showSearch" style="flex: 1 1 auto"></span>
        <smartstock-search-input [searchProgressFlag]="searchProgressFlag"
                          *ngIf="!isMobile && showSearch" style="flex: 1 1 auto"
                          [showSearch]="showSearch"
                          [searchInputControl]="searchInputControl"
                          [searchPlaceholder]="searchPlaceholder">
        </smartstock-search-input>
        <span *ngIf="!isMobile && showSearch" style="width: 16px"></span>
        <button *ngIf="noOfProductsInCart> 0 && !isMobile" mat-icon-button (click)="cartdrawer.toggle()"
                [matBadge]="noOfProductsInCart">
          <mat-icon>shopping_cart</mat-icon>
        </button>
        <button *ngIf="!isMobile" class="ft-button" mat-button [matMenuTriggerFor]="menu">
          <mat-icon>account_circle</mat-icon>
          <span *ngIf="currentUser">{{"  " + currentUser.username}}</span>
        </button>
        <button *ngIf="isMobile" mat-icon-button [matMenuTriggerFor]="menu">
          <mat-icon>more_vert</mat-icon>
          <!--      <span *ngIf="currentUser">{{"  " + currentUser.username}}</span>-->
        </button>
        <mat-menu #menu>
          <button mat-menu-item (click)="logout()">
            <mat-icon>exit_to_app</mat-icon>
            Logout
          </button>
          <button mat-menu-item routerLink="/account/profile">
            <mat-icon>person</mat-icon>
            My Profile
          </button>
        </mat-menu>
      </mat-toolbar-row>

      <mat-toolbar-row *ngIf="isMobile && showSearch">
        <!--    <span style="flex-grow: 1"></span>-->
        <smartstock-search-input [searchProgressFlag]="searchProgressFlag"
                          style="flex: 1 1 auto"
                          [showSearch]="showSearch"
                          [searchInputControl]="searchInputControl"
                          [searchPlaceholder]="searchPlaceholder">
        </smartstock-search-input>
        <!--    <span style="flex-grow: 1"></span>-->
      </mat-toolbar-row>
    </mat-toolbar>
  `
            },] }
];
ToolbarComponent.ctorParameters = () => [
    { type: Router },
    { type: StorageService },
    { type: UserService },
    { type: EventService }
];
ToolbarComponent.propDecorators = {
    heading: [{ type: Input }],
    showProgress: [{ type: Input }],
    sidenav: [{ type: Input }],
    hasBackRoute: [{ type: Input }],
    backLink: [{ type: Input }],
    cartdrawer: [{ type: Input }],
    showSearch: [{ type: Input }],
    searchCallback: [{ type: Output }],
    searchInputControl: [{ type: Input }],
    searchPlaceholder: [{ type: Input }],
    searchProgressFlag: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbGJhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL3dhcHBpL1dlYlN0b3JtUHJvamVjdHMvc21hcnRzdG9jay1jb3JlLWxpYnMvcHJvamVjdHMvbGlicy9zcmMvIiwic291cmNlcyI6WyJjb21wb25lbnRzL3Rvb2xiYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFFN0UsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZDLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUMsWUFBWSxFQUFFLG9CQUFvQixFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDbEUsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDZCQUE2QixDQUFDO0FBQzNELE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUVyRCxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sMkJBQTJCLENBQUM7QUFDcEQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLDJCQUEyQixDQUFDO0FBNkR2RCxNQUFNLE9BQU8sZ0JBQWdCO0lBaUIzQixZQUE2QixNQUFjLEVBQ2QsT0FBdUIsRUFDdkIsWUFBeUIsRUFDekIsWUFBMEI7UUFIMUIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLFlBQU8sR0FBUCxPQUFPLENBQWdCO1FBQ3ZCLGlCQUFZLEdBQVosWUFBWSxDQUFhO1FBQ3pCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBbEI5QyxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUVyQixpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUdyQixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUM3Qyx1QkFBa0IsR0FBRyxJQUFJLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUt6Qyx1QkFBa0IsR0FBRyxLQUFLLENBQUM7UUFDcEMsYUFBUSxHQUFHLEtBQUssQ0FBQyxDQUFDLHVCQUF1QjtJQU16QyxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFlBQVksQ0FBQyxJQUFJLENBQ3ZDLFlBQVksQ0FBQyxHQUFHLENBQUMsRUFDakIsb0JBQW9CLEVBQUUsQ0FDdkIsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDZCxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMseUJBQXlCLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0lBRUQsaUJBQWlCO1FBQ2YsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFVBQVUsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ3RELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELE1BQU07UUFDSixJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFO1lBQzFDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFTyx5QkFBeUI7UUFDL0IseURBQXlEO1FBQ3pELHVDQUF1QztRQUN2QyxNQUFNO0lBQ1IsQ0FBQzs7O1lBakhGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsb0JBQW9CO2dCQUM5QixRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1RFQ7YUFDRjs7O1lBbkVPLE1BQU07WUFHTixjQUFjO1lBQ2QsV0FBVztZQUdYLFlBQVk7OztzQkE4RGpCLEtBQUs7MkJBQ0wsS0FBSztzQkFDTCxLQUFLOzJCQUNMLEtBQUs7dUJBQ0wsS0FBSzt5QkFDTCxLQUFLO3lCQUNMLEtBQUs7NkJBQ0wsTUFBTTtpQ0FDTixLQUFLO2dDQUNMLEtBQUs7aUNBSUwsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge01hdFNpZGVuYXZ9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3NpZGVuYXYnO1xuaW1wb3J0IHtSb3V0ZXJ9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQge0Zvcm1Db250cm9sfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQge2RlYm91bmNlVGltZSwgZGlzdGluY3RVbnRpbENoYW5nZWR9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7U3RvcmFnZVNlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2VzL3N0b3JhZ2Uuc2VydmljZSc7XG5pbXBvcnQge1VzZXJTZXJ2aWNlfSBmcm9tICcuLi9zZXJ2aWNlcy91c2VyLnNlcnZpY2UnO1xuaW1wb3J0IHtVc2VyTW9kZWx9IGZyb20gJy4uL21vZGVscy91c2VyLm1vZGVsJztcbmltcG9ydCB7U3NtRXZlbnRzfSBmcm9tICcuLi91dGlscy9ldmVudHNOYW1lcy51dGlsJztcbmltcG9ydCB7RXZlbnRTZXJ2aWNlfSBmcm9tICcuLi9zZXJ2aWNlcy9ldmVudC5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnc21hcnRzdG9jay10b29sYmFyJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bWF0LXRvb2xiYXIgY29sb3I9XCJwcmltYXJ5XCIgY2xhc3M9XCJzdGlja3ktdG9wIG1hdC1lbGV2YXRpb24tejRcIj5cbiAgICAgIDxtYXQtdG9vbGJhci1yb3c+XG48IS0tICAgICAgICA8YnV0dG9uIHJvdXRlckxpbms9XCJ7e2JhY2tMaW5rfX1cIiAqbmdJZj1cImhhc0JhY2tSb3V0ZSAmJiBiYWNrTGlua1wiIG1hdC1pY29uLWJ1dHRvbj4tLT5cbjwhLS0gICAgICAgICAgPG1hdC1pY29uPmFycm93X2JhY2s8L21hdC1pY29uPi0tPlxuPCEtLSAgICAgICAgPC9idXR0b24+LS0+XG4gICAgICAgIDxidXR0b24gbWF0LWljb24tYnV0dG9uIChjbGljayk9XCJzaWRlbmF2LnRvZ2dsZSgpXCI+XG4gICAgICAgICAgPG1hdC1pY29uPm1lbnU8L21hdC1pY29uPlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPHNwYW4+e3toZWFkaW5nfX08L3NwYW4+XG4gICAgICAgIDxzcGFuICpuZ0lmPVwiaXNNb2JpbGVcIiBzdHlsZT1cImZsZXg6IDEgMSBhdXRvXCI+PC9zcGFuPlxuICAgICAgICA8c3BhbiAqbmdJZj1cIiFpc01vYmlsZSAmJiBzaG93U2VhcmNoXCIgc3R5bGU9XCJ3aWR0aDogMTZweFwiPjwvc3Bhbj5cbiAgICAgICAgPHNwYW4gKm5nSWY9XCIhaXNNb2JpbGUgJiYgIXNob3dTZWFyY2hcIiBzdHlsZT1cImZsZXg6IDEgMSBhdXRvXCI+PC9zcGFuPlxuICAgICAgICA8c21hcnRzdG9jay1zZWFyY2gtaW5wdXQgW3NlYXJjaFByb2dyZXNzRmxhZ109XCJzZWFyY2hQcm9ncmVzc0ZsYWdcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cIiFpc01vYmlsZSAmJiBzaG93U2VhcmNoXCIgc3R5bGU9XCJmbGV4OiAxIDEgYXV0b1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFtzaG93U2VhcmNoXT1cInNob3dTZWFyY2hcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICBbc2VhcmNoSW5wdXRDb250cm9sXT1cInNlYXJjaElucHV0Q29udHJvbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFtzZWFyY2hQbGFjZWhvbGRlcl09XCJzZWFyY2hQbGFjZWhvbGRlclwiPlxuICAgICAgICA8L3NtYXJ0c3RvY2stc2VhcmNoLWlucHV0PlxuICAgICAgICA8c3BhbiAqbmdJZj1cIiFpc01vYmlsZSAmJiBzaG93U2VhcmNoXCIgc3R5bGU9XCJ3aWR0aDogMTZweFwiPjwvc3Bhbj5cbiAgICAgICAgPGJ1dHRvbiAqbmdJZj1cIm5vT2ZQcm9kdWN0c0luQ2FydD4gMCAmJiAhaXNNb2JpbGVcIiBtYXQtaWNvbi1idXR0b24gKGNsaWNrKT1cImNhcnRkcmF3ZXIudG9nZ2xlKClcIlxuICAgICAgICAgICAgICAgIFttYXRCYWRnZV09XCJub09mUHJvZHVjdHNJbkNhcnRcIj5cbiAgICAgICAgICA8bWF0LWljb24+c2hvcHBpbmdfY2FydDwvbWF0LWljb24+XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uICpuZ0lmPVwiIWlzTW9iaWxlXCIgY2xhc3M9XCJmdC1idXR0b25cIiBtYXQtYnV0dG9uIFttYXRNZW51VHJpZ2dlckZvcl09XCJtZW51XCI+XG4gICAgICAgICAgPG1hdC1pY29uPmFjY291bnRfY2lyY2xlPC9tYXQtaWNvbj5cbiAgICAgICAgICA8c3BhbiAqbmdJZj1cImN1cnJlbnRVc2VyXCI+e3tcIiAgXCIgKyBjdXJyZW50VXNlci51c2VybmFtZX19PC9zcGFuPlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPGJ1dHRvbiAqbmdJZj1cImlzTW9iaWxlXCIgbWF0LWljb24tYnV0dG9uIFttYXRNZW51VHJpZ2dlckZvcl09XCJtZW51XCI+XG4gICAgICAgICAgPG1hdC1pY29uPm1vcmVfdmVydDwvbWF0LWljb24+XG4gICAgICAgICAgPCEtLSAgICAgIDxzcGFuICpuZ0lmPVwiY3VycmVudFVzZXJcIj57e1wiICBcIiArIGN1cnJlbnRVc2VyLnVzZXJuYW1lfX08L3NwYW4+LS0+XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8bWF0LW1lbnUgI21lbnU+XG4gICAgICAgICAgPGJ1dHRvbiBtYXQtbWVudS1pdGVtIChjbGljayk9XCJsb2dvdXQoKVwiPlxuICAgICAgICAgICAgPG1hdC1pY29uPmV4aXRfdG9fYXBwPC9tYXQtaWNvbj5cbiAgICAgICAgICAgIExvZ291dFxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b24gbWF0LW1lbnUtaXRlbSByb3V0ZXJMaW5rPVwiL2FjY291bnQvcHJvZmlsZVwiPlxuICAgICAgICAgICAgPG1hdC1pY29uPnBlcnNvbjwvbWF0LWljb24+XG4gICAgICAgICAgICBNeSBQcm9maWxlXG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvbWF0LW1lbnU+XG4gICAgICA8L21hdC10b29sYmFyLXJvdz5cblxuICAgICAgPG1hdC10b29sYmFyLXJvdyAqbmdJZj1cImlzTW9iaWxlICYmIHNob3dTZWFyY2hcIj5cbiAgICAgICAgPCEtLSAgICA8c3BhbiBzdHlsZT1cImZsZXgtZ3JvdzogMVwiPjwvc3Bhbj4tLT5cbiAgICAgICAgPHNtYXJ0c3RvY2stc2VhcmNoLWlucHV0IFtzZWFyY2hQcm9ncmVzc0ZsYWddPVwic2VhcmNoUHJvZ3Jlc3NGbGFnXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9XCJmbGV4OiAxIDEgYXV0b1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFtzaG93U2VhcmNoXT1cInNob3dTZWFyY2hcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICBbc2VhcmNoSW5wdXRDb250cm9sXT1cInNlYXJjaElucHV0Q29udHJvbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFtzZWFyY2hQbGFjZWhvbGRlcl09XCJzZWFyY2hQbGFjZWhvbGRlclwiPlxuICAgICAgICA8L3NtYXJ0c3RvY2stc2VhcmNoLWlucHV0PlxuICAgICAgICA8IS0tICAgIDxzcGFuIHN0eWxlPVwiZmxleC1ncm93OiAxXCI+PC9zcGFuPi0tPlxuICAgICAgPC9tYXQtdG9vbGJhci1yb3c+XG4gICAgPC9tYXQtdG9vbGJhcj5cbiAgYCxcbn0pXG5leHBvcnQgY2xhc3MgVG9vbGJhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpIGhlYWRpbmc6IHN0cmluZztcbiAgQElucHV0KCkgc2hvd1Byb2dyZXNzID0gZmFsc2U7XG4gIEBJbnB1dCgpIHNpZGVuYXY6IE1hdFNpZGVuYXY7XG4gIEBJbnB1dCgpIGhhc0JhY2tSb3V0ZSA9IGZhbHNlO1xuICBASW5wdXQoKSBiYWNrTGluazogc3RyaW5nO1xuICBASW5wdXQoKSBjYXJ0ZHJhd2VyOiBNYXRTaWRlbmF2O1xuICBASW5wdXQoKSBzaG93U2VhcmNoID0gZmFsc2U7XG4gIEBPdXRwdXQoKSBzZWFyY2hDYWxsYmFjayA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuICBASW5wdXQoKSBzZWFyY2hJbnB1dENvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woJycpO1xuICBASW5wdXQoKSBzZWFyY2hQbGFjZWhvbGRlcjogc3RyaW5nIHwgJ1R5cGUgdG8gc2VhcmNoJztcbiAgY3VycmVudFVzZXI6IFVzZXJNb2RlbDtcblxuICBub09mUHJvZHVjdHNJbkNhcnQ7XG4gIEBJbnB1dCgpIHNlYXJjaFByb2dyZXNzRmxhZyA9IGZhbHNlO1xuICBpc01vYmlsZSA9IGZhbHNlOyAvLyBlbnZpcm9ubWVudC5hbmRyb2lkO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgcm91dGVyOiBSb3V0ZXIsXG4gICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgc3RvcmFnZTogU3RvcmFnZVNlcnZpY2UsXG4gICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgdXNlckRhdGFiYXNlOiBVc2VyU2VydmljZSxcbiAgICAgICAgICAgICAgcHJpdmF0ZSByZWFkb25seSBldmVudFNlcnZpY2U6IEV2ZW50U2VydmljZSkge1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5zdG9yYWdlLmdldEFjdGl2ZVVzZXIoKS50aGVuKHVzZXIgPT4ge1xuICAgICAgdGhpcy5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgfSk7XG4gICAgdGhpcy5zZWFyY2hJbnB1dENvbnRyb2wudmFsdWVDaGFuZ2VzLnBpcGUoXG4gICAgICBkZWJvdW5jZVRpbWUoNTAwKSxcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKClcbiAgICApLnN1YnNjcmliZShfID0+IHtcbiAgICAgIHRoaXMuc2VhcmNoQ2FsbGJhY2suZW1pdCh0aGlzLnNlYXJjaElucHV0Q29udHJvbC52YWx1ZSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmdldFByb2R1Y3RzSW5DYXJ0KCk7XG4gICAgdGhpcy5fY2xlYXJTZWFyY2hJbnB1dExpc3RlbmVyKCk7XG4gIH1cblxuICBnZXRQcm9kdWN0c0luQ2FydCgpOiB2b2lkIHtcbiAgICB0aGlzLmV2ZW50U2VydmljZS5saXN0ZW4oU3NtRXZlbnRzLk5PX09GX0NBUlQsIChkYXRhKSA9PiB7XG4gICAgICB0aGlzLm5vT2ZQcm9kdWN0c0luQ2FydCA9IGRhdGEuZGV0YWlsO1xuICAgIH0pO1xuICB9XG5cbiAgbG9nb3V0KCk6IHZvaWQge1xuICAgIHRoaXMudXNlckRhdGFiYXNlLmxvZ291dChudWxsKS5maW5hbGx5KCgpID0+IHtcbiAgICAgIHJldHVybiB0aGlzLnJvdXRlci5uYXZpZ2F0ZUJ5VXJsKCcnKTtcbiAgICB9KS5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coJycpKTtcbiAgfVxuXG4gIHByaXZhdGUgX2NsZWFyU2VhcmNoSW5wdXRMaXN0ZW5lcigpOiB2b2lkIHtcbiAgICAvLyB0aGlzLmV2ZW50U2VydmljZS5saXN0ZW4oU3NtRXZlbnRzLkFERF9DQVJULCBkYXRhID0+IHtcbiAgICAvLyAgIHRoaXMuc2VhcmNoSW5wdXRDb250cm9sLnJlc2V0KCcnKTtcbiAgICAvLyB9KTtcbiAgfVxufVxuIl19