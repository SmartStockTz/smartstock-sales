import { Component, Input } from '@angular/core';
import { of } from 'rxjs';
import { EventService } from '../services/event.service';
import { UserService } from '../services/user.service';
import { LogService } from '../services/log.service';
import { SsmEvents } from '../utils/eventsNames.util';
import { ConfigsService } from '../services/configs.service';
export class DrawerComponent {
    constructor(userService, logger, eventApi) {
        this.userService = userService;
        this.logger = logger;
        this.eventApi = eventApi;
        this.versionNumber = of();
        this.selectedMenu = {
            background: '#1b5e20',
            borderTopRightRadius: '50px',
            borderBottomRightRadius: '50px',
            color: 'white'
        };
    }
    ngOnInit() {
        this.versionNumber = of(ConfigsService.versionName);
        this.userService.getCurrentShop().then(shop => {
            this.shop = shop;
        }).catch(reason => {
            this.logger.i(reason);
            this.shop = undefined;
        });
        this.userService.currentUser().then(user => {
            this.currentUser = user;
        });
        this.eventApi.listen(SsmEvents.SETTINGS_UPDATED, data => {
            this.userService.getCurrentShop().then(shop => {
                this.shop = shop;
            }).catch(reason => {
                this.logger.e(reason, 'AdminDrawerComponent:37');
                this.shop = undefined;
            });
        });
    }
    shouldExpand(route) {
        const url = new URL(location.href);
        return url.pathname.startsWith('/' + route);
    }
    isManager() {
        return this.currentUser && (this.currentUser.role === 'admin' || this.currentUser.role === 'manager');
    }
    isAdmin() {
        return this.currentUser && (this.currentUser.role === 'admin');
    }
}
DrawerComponent.decorators = [
    { type: Component, args: [{
                selector: 'smartstock-drawer',
                template: `
    <div class="my-side-nav">
      <div>
        <div class="d-flex justify-content-center align-items-center flex-column" style="padding-bottom: 8px">
          <div style="padding: 16px; justify-content: center; align-items: center">
            <mat-icon style="width: 70px; height: 70px; font-size: 70px" color="primary">store</mat-icon>
          </div>
          <span style="max-width: 150px; overflow: hidden; text-overflow: ellipsis;"
                *ngIf="shop">{{shop.businessName}}</span>
          <span style="width: 4px; height: 4px"></span>
          <button style="width: 80%"
                  color="primary"
                  class="btn-block"
                  routerLink="/account/shop" mat-button>
            Change Shop
          </button>
        </div>

        <div class="d-flex justify-content-center align-items-center">
          <mat-divider></mat-divider>
        </div>

        <mat-accordion [multi]="true" class="mat-elevation-z0">
          <mat-nav-list *ngIf="isAdmin()" class="mat-elevation-z0">
            <mat-list-item [ngStyle]="shouldExpand('dashboard')?selectedMenu:{}" routerLink="/dashboard">
              <mat-icon matListIcon matPrefix>dashboard</mat-icon>
              <span matLine style="margin-left: 8px">Dashboard</span>
            </mat-list-item>
          </mat-nav-list>

          <mat-divider *ngIf="isAdmin()"></mat-divider>

          <mat-expansion-panel *ngIf="isAdmin()" [expanded]="shouldExpand('report')" class="mat-elevation-z0">
            <mat-expansion-panel-header>
              <mat-icon matPrefix>table_chart</mat-icon>
              <span style="margin-left: 8px">Reports</span>
            </mat-expansion-panel-header>
            <mat-nav-list>
              <a mat-list-item routerLink="/report/sales">Sales Reports</a>
              <a mat-list-item routerLink="/report/stocks">Stock Reports</a>
            </mat-nav-list>
          </mat-expansion-panel>

          <mat-divider *ngIf="currentUser && currentUser.role==='admin'"></mat-divider>

          <mat-nav-list>
            <mat-list-item [ngStyle]="shouldExpand('sale')?selectedMenu:{}" routerLink="/sale">
              <mat-icon matListIcon matPrefix>shop_front</mat-icon>
              <span matLine style="margin-left: 8px">Sale</span>
            </mat-list-item>
          </mat-nav-list>

          <mat-divider></mat-divider>

          <mat-expansion-panel *ngIf="isManager()" [expanded]="shouldExpand('purchase')" class="mat-elevation-z0">
            <mat-expansion-panel-header>
              <mat-icon matPrefix>receipts</mat-icon>
              <span style="margin-left: 8px">Purchase</span>
            </mat-expansion-panel-header>
            <mat-nav-list>
              <a mat-list-item routerLink="/purchase">All Purchases</a>
              <a mat-list-item routerLink="/purchase/create">New Purchase</a>
              <a mat-list-item routerLink="/stock" [queryParams]="{t:3}">Suppliers</a>
            </mat-nav-list>
          </mat-expansion-panel>

          <mat-divider *ngIf="currentUser && (currentUser.role==='admin' || currentUser.role === 'manager')"></mat-divider>

          <mat-nav-list *ngIf="isManager()">
            <mat-list-item [ngStyle]="shouldExpand('stock')?selectedMenu:{}" routerLink="/stock">
              <mat-icon matListIcon matPrefix>store</mat-icon>
              <span matLine style="margin-left: 8px">Stock</span>
            </mat-list-item>
          </mat-nav-list>

          <mat-divider *ngIf="isManager()"></mat-divider>

          <mat-expansion-panel [expanded]="shouldExpand('settings')" class="mat-elevation-z0">
            <mat-expansion-panel-header>
              <mat-icon matPrefix>supervisor_account</mat-icon>
              <span style="margin-left: 8px">Account</span>
            </mat-expansion-panel-header>
            <mat-nav-list>
              <a *ngIf="isManager()" mat-list-item
                 routerLink="/account/settings">
                <div class="d-flex flex-row flex-nowrap btn-block">
                  <span>Settings</span>
                  <span class="flex-grow-1"></span>
                  <mat-icon>settings</mat-icon>
                </div>
              </a>
              <a *ngIf="isManager()" mat-list-item
                 routerLink="/account/users">
                <div class="d-flex flex-row flex-nowrap btn-block">
                  <span>Users</span>
                  <span class="flex-grow-1"></span>
                  <mat-icon>person_add</mat-icon>
                </div>
              </a>
              <a mat-list-item routerLink="/account/profile">
                <div class="d-flex flex-row flex-nowrap btn-block">
                  <span>Profile</span>
                  <span class="flex-grow-1"></span>
                  <mat-icon>person</mat-icon>
                </div>
              </a>
            </mat-nav-list>
          </mat-expansion-panel>
        </mat-accordion>

      </div>
      <span style="flex-grow: 1"></span>
      <div style="display: flex; justify-content: center; align-items: center">
        <span>Version: {{versionNumber | async}}</span>
      </div>
    </div>
  `,
                styles: [".my-side-nav{display:flex;flex-direction:column;min-height:100vh;width:100%;z-index:50000}.drawer-head{background-position:50%;background-repeat:no-repeat;background-size:cover;height:180px}div.mat-list-item-content{width:100%!important}mat-divider{margin-left:10%;margin-right:10%;width:80%}"]
            },] }
];
DrawerComponent.ctorParameters = () => [
    { type: UserService },
    { type: LogService },
    { type: EventService }
];
DrawerComponent.propDecorators = {
    versionNumber: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvd2FwcGkvV2ViU3Rvcm1Qcm9qZWN0cy9zbWFydHN0b2NrLWNvcmUtbGlicy9wcm9qZWN0cy9saWJzL3NyYy8iLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvZHJhd2VyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLEtBQUssRUFBUyxNQUFNLGVBQWUsQ0FBQztBQUN2RCxPQUFPLEVBQWEsRUFBRSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ3BDLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RCxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFDckQsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ25ELE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSwyQkFBMkIsQ0FBQztBQUVwRCxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNkJBQTZCLENBQUM7QUEySDNELE1BQU0sT0FBTyxlQUFlO0lBRTFCLFlBQTZCLFdBQXdCLEVBQ3hCLE1BQWtCLEVBQ2xCLFFBQXNCO1FBRnRCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQ3hCLFdBQU0sR0FBTixNQUFNLENBQVk7UUFDbEIsYUFBUSxHQUFSLFFBQVEsQ0FBYztRQUsxQyxrQkFBYSxHQUF1QixFQUFFLEVBQUUsQ0FBQztRQUNsRCxpQkFBWSxHQUFHO1lBQ2IsVUFBVSxFQUFFLFNBQVM7WUFDckIsb0JBQW9CLEVBQUUsTUFBTTtZQUM1Qix1QkFBdUIsRUFBRSxNQUFNO1lBQy9CLEtBQUssRUFBRSxPQUFPO1NBQ2YsQ0FBQztJQVZGLENBQUM7SUFZRCxRQUFRO1FBQ04sSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzVDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ25CLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN0QixJQUFJLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3pDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFO1lBQ3RELElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUM1QyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztZQUNuQixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ2hCLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO2dCQUNqRCxJQUFJLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQztZQUN4QixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFhO1FBQ3hCLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuQyxPQUFPLEdBQUcsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQsU0FBUztRQUNQLE9BQU8sSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxLQUFLLE9BQU8sSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsQ0FBQztJQUN4RyxDQUFDO0lBRUQsT0FBTztRQUNMLE9BQU8sSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxLQUFLLE9BQU8sQ0FBQyxDQUFDO0lBQ2pFLENBQUM7OztZQTFLRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLG1CQUFtQjtnQkFDN0IsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQW9IVDs7YUFFRjs7O1lBOUhPLFdBQVc7WUFDWCxVQUFVO1lBRlYsWUFBWTs7OzRCQXlJakIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBJbnB1dCwgT25Jbml0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7T2JzZXJ2YWJsZSwgb2Z9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtFdmVudFNlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2VzL2V2ZW50LnNlcnZpY2UnO1xuaW1wb3J0IHtVc2VyU2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvdXNlci5zZXJ2aWNlJztcbmltcG9ydCB7TG9nU2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHtTc21FdmVudHN9IGZyb20gJy4uL3V0aWxzL2V2ZW50c05hbWVzLnV0aWwnO1xuaW1wb3J0IHtTaG9wTW9kZWx9IGZyb20gJy4uL21vZGVscy9zaG9wLm1vZGVsJztcbmltcG9ydCB7Q29uZmlnc1NlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2VzL2NvbmZpZ3Muc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3NtYXJ0c3RvY2stZHJhd2VyJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2IGNsYXNzPVwibXktc2lkZS1uYXZcIj5cbiAgICAgIDxkaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXgganVzdGlmeS1jb250ZW50LWNlbnRlciBhbGlnbi1pdGVtcy1jZW50ZXIgZmxleC1jb2x1bW5cIiBzdHlsZT1cInBhZGRpbmctYm90dG9tOiA4cHhcIj5cbiAgICAgICAgICA8ZGl2IHN0eWxlPVwicGFkZGluZzogMTZweDsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7IGFsaWduLWl0ZW1zOiBjZW50ZXJcIj5cbiAgICAgICAgICAgIDxtYXQtaWNvbiBzdHlsZT1cIndpZHRoOiA3MHB4OyBoZWlnaHQ6IDcwcHg7IGZvbnQtc2l6ZTogNzBweFwiIGNvbG9yPVwicHJpbWFyeVwiPnN0b3JlPC9tYXQtaWNvbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8c3BhbiBzdHlsZT1cIm1heC13aWR0aDogMTUwcHg7IG92ZXJmbG93OiBoaWRkZW47IHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO1wiXG4gICAgICAgICAgICAgICAgKm5nSWY9XCJzaG9wXCI+e3tzaG9wLmJ1c2luZXNzTmFtZX19PC9zcGFuPlxuICAgICAgICAgIDxzcGFuIHN0eWxlPVwid2lkdGg6IDRweDsgaGVpZ2h0OiA0cHhcIj48L3NwYW4+XG4gICAgICAgICAgPGJ1dHRvbiBzdHlsZT1cIndpZHRoOiA4MCVcIlxuICAgICAgICAgICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICAgIGNsYXNzPVwiYnRuLWJsb2NrXCJcbiAgICAgICAgICAgICAgICAgIHJvdXRlckxpbms9XCIvYWNjb3VudC9zaG9wXCIgbWF0LWJ1dHRvbj5cbiAgICAgICAgICAgIENoYW5nZSBTaG9wXG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXgganVzdGlmeS1jb250ZW50LWNlbnRlciBhbGlnbi1pdGVtcy1jZW50ZXJcIj5cbiAgICAgICAgICA8bWF0LWRpdmlkZXI+PC9tYXQtZGl2aWRlcj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPG1hdC1hY2NvcmRpb24gW211bHRpXT1cInRydWVcIiBjbGFzcz1cIm1hdC1lbGV2YXRpb24tejBcIj5cbiAgICAgICAgICA8bWF0LW5hdi1saXN0ICpuZ0lmPVwiaXNBZG1pbigpXCIgY2xhc3M9XCJtYXQtZWxldmF0aW9uLXowXCI+XG4gICAgICAgICAgICA8bWF0LWxpc3QtaXRlbSBbbmdTdHlsZV09XCJzaG91bGRFeHBhbmQoJ2Rhc2hib2FyZCcpP3NlbGVjdGVkTWVudTp7fVwiIHJvdXRlckxpbms9XCIvZGFzaGJvYXJkXCI+XG4gICAgICAgICAgICAgIDxtYXQtaWNvbiBtYXRMaXN0SWNvbiBtYXRQcmVmaXg+ZGFzaGJvYXJkPC9tYXQtaWNvbj5cbiAgICAgICAgICAgICAgPHNwYW4gbWF0TGluZSBzdHlsZT1cIm1hcmdpbi1sZWZ0OiA4cHhcIj5EYXNoYm9hcmQ8L3NwYW4+XG4gICAgICAgICAgICA8L21hdC1saXN0LWl0ZW0+XG4gICAgICAgICAgPC9tYXQtbmF2LWxpc3Q+XG5cbiAgICAgICAgICA8bWF0LWRpdmlkZXIgKm5nSWY9XCJpc0FkbWluKClcIj48L21hdC1kaXZpZGVyPlxuXG4gICAgICAgICAgPG1hdC1leHBhbnNpb24tcGFuZWwgKm5nSWY9XCJpc0FkbWluKClcIiBbZXhwYW5kZWRdPVwic2hvdWxkRXhwYW5kKCdyZXBvcnQnKVwiIGNsYXNzPVwibWF0LWVsZXZhdGlvbi16MFwiPlxuICAgICAgICAgICAgPG1hdC1leHBhbnNpb24tcGFuZWwtaGVhZGVyPlxuICAgICAgICAgICAgICA8bWF0LWljb24gbWF0UHJlZml4PnRhYmxlX2NoYXJ0PC9tYXQtaWNvbj5cbiAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9XCJtYXJnaW4tbGVmdDogOHB4XCI+UmVwb3J0czwvc3Bhbj5cbiAgICAgICAgICAgIDwvbWF0LWV4cGFuc2lvbi1wYW5lbC1oZWFkZXI+XG4gICAgICAgICAgICA8bWF0LW5hdi1saXN0PlxuICAgICAgICAgICAgICA8YSBtYXQtbGlzdC1pdGVtIHJvdXRlckxpbms9XCIvcmVwb3J0L3NhbGVzXCI+U2FsZXMgUmVwb3J0czwvYT5cbiAgICAgICAgICAgICAgPGEgbWF0LWxpc3QtaXRlbSByb3V0ZXJMaW5rPVwiL3JlcG9ydC9zdG9ja3NcIj5TdG9jayBSZXBvcnRzPC9hPlxuICAgICAgICAgICAgPC9tYXQtbmF2LWxpc3Q+XG4gICAgICAgICAgPC9tYXQtZXhwYW5zaW9uLXBhbmVsPlxuXG4gICAgICAgICAgPG1hdC1kaXZpZGVyICpuZ0lmPVwiY3VycmVudFVzZXIgJiYgY3VycmVudFVzZXIucm9sZT09PSdhZG1pbidcIj48L21hdC1kaXZpZGVyPlxuXG4gICAgICAgICAgPG1hdC1uYXYtbGlzdD5cbiAgICAgICAgICAgIDxtYXQtbGlzdC1pdGVtIFtuZ1N0eWxlXT1cInNob3VsZEV4cGFuZCgnc2FsZScpP3NlbGVjdGVkTWVudTp7fVwiIHJvdXRlckxpbms9XCIvc2FsZVwiPlxuICAgICAgICAgICAgICA8bWF0LWljb24gbWF0TGlzdEljb24gbWF0UHJlZml4PnNob3BfZnJvbnQ8L21hdC1pY29uPlxuICAgICAgICAgICAgICA8c3BhbiBtYXRMaW5lIHN0eWxlPVwibWFyZ2luLWxlZnQ6IDhweFwiPlNhbGU8L3NwYW4+XG4gICAgICAgICAgICA8L21hdC1saXN0LWl0ZW0+XG4gICAgICAgICAgPC9tYXQtbmF2LWxpc3Q+XG5cbiAgICAgICAgICA8bWF0LWRpdmlkZXI+PC9tYXQtZGl2aWRlcj5cblxuICAgICAgICAgIDxtYXQtZXhwYW5zaW9uLXBhbmVsICpuZ0lmPVwiaXNNYW5hZ2VyKClcIiBbZXhwYW5kZWRdPVwic2hvdWxkRXhwYW5kKCdwdXJjaGFzZScpXCIgY2xhc3M9XCJtYXQtZWxldmF0aW9uLXowXCI+XG4gICAgICAgICAgICA8bWF0LWV4cGFuc2lvbi1wYW5lbC1oZWFkZXI+XG4gICAgICAgICAgICAgIDxtYXQtaWNvbiBtYXRQcmVmaXg+cmVjZWlwdHM8L21hdC1pY29uPlxuICAgICAgICAgICAgICA8c3BhbiBzdHlsZT1cIm1hcmdpbi1sZWZ0OiA4cHhcIj5QdXJjaGFzZTwvc3Bhbj5cbiAgICAgICAgICAgIDwvbWF0LWV4cGFuc2lvbi1wYW5lbC1oZWFkZXI+XG4gICAgICAgICAgICA8bWF0LW5hdi1saXN0PlxuICAgICAgICAgICAgICA8YSBtYXQtbGlzdC1pdGVtIHJvdXRlckxpbms9XCIvcHVyY2hhc2VcIj5BbGwgUHVyY2hhc2VzPC9hPlxuICAgICAgICAgICAgICA8YSBtYXQtbGlzdC1pdGVtIHJvdXRlckxpbms9XCIvcHVyY2hhc2UvY3JlYXRlXCI+TmV3IFB1cmNoYXNlPC9hPlxuICAgICAgICAgICAgICA8YSBtYXQtbGlzdC1pdGVtIHJvdXRlckxpbms9XCIvc3RvY2tcIiBbcXVlcnlQYXJhbXNdPVwie3Q6M31cIj5TdXBwbGllcnM8L2E+XG4gICAgICAgICAgICA8L21hdC1uYXYtbGlzdD5cbiAgICAgICAgICA8L21hdC1leHBhbnNpb24tcGFuZWw+XG5cbiAgICAgICAgICA8bWF0LWRpdmlkZXIgKm5nSWY9XCJjdXJyZW50VXNlciAmJiAoY3VycmVudFVzZXIucm9sZT09PSdhZG1pbicgfHwgY3VycmVudFVzZXIucm9sZSA9PT0gJ21hbmFnZXInKVwiPjwvbWF0LWRpdmlkZXI+XG5cbiAgICAgICAgICA8bWF0LW5hdi1saXN0ICpuZ0lmPVwiaXNNYW5hZ2VyKClcIj5cbiAgICAgICAgICAgIDxtYXQtbGlzdC1pdGVtIFtuZ1N0eWxlXT1cInNob3VsZEV4cGFuZCgnc3RvY2snKT9zZWxlY3RlZE1lbnU6e31cIiByb3V0ZXJMaW5rPVwiL3N0b2NrXCI+XG4gICAgICAgICAgICAgIDxtYXQtaWNvbiBtYXRMaXN0SWNvbiBtYXRQcmVmaXg+c3RvcmU8L21hdC1pY29uPlxuICAgICAgICAgICAgICA8c3BhbiBtYXRMaW5lIHN0eWxlPVwibWFyZ2luLWxlZnQ6IDhweFwiPlN0b2NrPC9zcGFuPlxuICAgICAgICAgICAgPC9tYXQtbGlzdC1pdGVtPlxuICAgICAgICAgIDwvbWF0LW5hdi1saXN0PlxuXG4gICAgICAgICAgPG1hdC1kaXZpZGVyICpuZ0lmPVwiaXNNYW5hZ2VyKClcIj48L21hdC1kaXZpZGVyPlxuXG4gICAgICAgICAgPG1hdC1leHBhbnNpb24tcGFuZWwgW2V4cGFuZGVkXT1cInNob3VsZEV4cGFuZCgnc2V0dGluZ3MnKVwiIGNsYXNzPVwibWF0LWVsZXZhdGlvbi16MFwiPlxuICAgICAgICAgICAgPG1hdC1leHBhbnNpb24tcGFuZWwtaGVhZGVyPlxuICAgICAgICAgICAgICA8bWF0LWljb24gbWF0UHJlZml4PnN1cGVydmlzb3JfYWNjb3VudDwvbWF0LWljb24+XG4gICAgICAgICAgICAgIDxzcGFuIHN0eWxlPVwibWFyZ2luLWxlZnQ6IDhweFwiPkFjY291bnQ8L3NwYW4+XG4gICAgICAgICAgICA8L21hdC1leHBhbnNpb24tcGFuZWwtaGVhZGVyPlxuICAgICAgICAgICAgPG1hdC1uYXYtbGlzdD5cbiAgICAgICAgICAgICAgPGEgKm5nSWY9XCJpc01hbmFnZXIoKVwiIG1hdC1saXN0LWl0ZW1cbiAgICAgICAgICAgICAgICAgcm91dGVyTGluaz1cIi9hY2NvdW50L3NldHRpbmdzXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleCBmbGV4LXJvdyBmbGV4LW5vd3JhcCBidG4tYmxvY2tcIj5cbiAgICAgICAgICAgICAgICAgIDxzcGFuPlNldHRpbmdzPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmbGV4LWdyb3ctMVwiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgIDxtYXQtaWNvbj5zZXR0aW5nczwvbWF0LWljb24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgICAgPGEgKm5nSWY9XCJpc01hbmFnZXIoKVwiIG1hdC1saXN0LWl0ZW1cbiAgICAgICAgICAgICAgICAgcm91dGVyTGluaz1cIi9hY2NvdW50L3VzZXJzXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleCBmbGV4LXJvdyBmbGV4LW5vd3JhcCBidG4tYmxvY2tcIj5cbiAgICAgICAgICAgICAgICAgIDxzcGFuPlVzZXJzPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmbGV4LWdyb3ctMVwiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgIDxtYXQtaWNvbj5wZXJzb25fYWRkPC9tYXQtaWNvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgICA8YSBtYXQtbGlzdC1pdGVtIHJvdXRlckxpbms9XCIvYWNjb3VudC9wcm9maWxlXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleCBmbGV4LXJvdyBmbGV4LW5vd3JhcCBidG4tYmxvY2tcIj5cbiAgICAgICAgICAgICAgICAgIDxzcGFuPlByb2ZpbGU8L3NwYW4+XG4gICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImZsZXgtZ3Jvdy0xXCI+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgPG1hdC1pY29uPnBlcnNvbjwvbWF0LWljb24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgIDwvbWF0LW5hdi1saXN0PlxuICAgICAgICAgIDwvbWF0LWV4cGFuc2lvbi1wYW5lbD5cbiAgICAgICAgPC9tYXQtYWNjb3JkaW9uPlxuXG4gICAgICA8L2Rpdj5cbiAgICAgIDxzcGFuIHN0eWxlPVwiZmxleC1ncm93OiAxXCI+PC9zcGFuPlxuICAgICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBhbGlnbi1pdGVtczogY2VudGVyXCI+XG4gICAgICAgIDxzcGFuPlZlcnNpb246IHt7dmVyc2lvbk51bWJlciB8IGFzeW5jfX08L3NwYW4+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgYCxcbiAgc3R5bGVVcmxzOiBbJy4uL3N0eWxlcy9hZG1pbi1kcmF3ZXIuc3R5bGUuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIERyYXdlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSB1c2VyU2VydmljZTogVXNlclNlcnZpY2UsXG4gICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyOiBMb2dTZXJ2aWNlLFxuICAgICAgICAgICAgICBwcml2YXRlIHJlYWRvbmx5IGV2ZW50QXBpOiBFdmVudFNlcnZpY2UpIHtcbiAgfVxuXG4gIHNob3A6IFNob3BNb2RlbDtcbiAgY3VycmVudFVzZXI6IGFueTtcbiAgQElucHV0KCkgdmVyc2lvbk51bWJlcjogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gb2YoKTtcbiAgc2VsZWN0ZWRNZW51ID0ge1xuICAgIGJhY2tncm91bmQ6ICcjMWI1ZTIwJyxcbiAgICBib3JkZXJUb3BSaWdodFJhZGl1czogJzUwcHgnLFxuICAgIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzOiAnNTBweCcsXG4gICAgY29sb3I6ICd3aGl0ZSdcbiAgfTtcblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnZlcnNpb25OdW1iZXIgPSBvZihDb25maWdzU2VydmljZS52ZXJzaW9uTmFtZSk7XG4gICAgdGhpcy51c2VyU2VydmljZS5nZXRDdXJyZW50U2hvcCgpLnRoZW4oc2hvcCA9PiB7XG4gICAgICB0aGlzLnNob3AgPSBzaG9wO1xuICAgIH0pLmNhdGNoKHJlYXNvbiA9PiB7XG4gICAgICB0aGlzLmxvZ2dlci5pKHJlYXNvbik7XG4gICAgICB0aGlzLnNob3AgPSB1bmRlZmluZWQ7XG4gICAgfSk7XG4gICAgdGhpcy51c2VyU2VydmljZS5jdXJyZW50VXNlcigpLnRoZW4odXNlciA9PiB7XG4gICAgICB0aGlzLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICB9KTtcbiAgICB0aGlzLmV2ZW50QXBpLmxpc3RlbihTc21FdmVudHMuU0VUVElOR1NfVVBEQVRFRCwgZGF0YSA9PiB7XG4gICAgICB0aGlzLnVzZXJTZXJ2aWNlLmdldEN1cnJlbnRTaG9wKCkudGhlbihzaG9wID0+IHtcbiAgICAgICAgdGhpcy5zaG9wID0gc2hvcDtcbiAgICAgIH0pLmNhdGNoKHJlYXNvbiA9PiB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmUocmVhc29uLCAnQWRtaW5EcmF3ZXJDb21wb25lbnQ6MzcnKTtcbiAgICAgICAgdGhpcy5zaG9wID0gdW5kZWZpbmVkO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBzaG91bGRFeHBhbmQocm91dGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwobG9jYXRpb24uaHJlZik7XG4gICAgcmV0dXJuIHVybC5wYXRobmFtZS5zdGFydHNXaXRoKCcvJyArIHJvdXRlKTtcbiAgfVxuXG4gIGlzTWFuYWdlcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlciAmJiAodGhpcy5jdXJyZW50VXNlci5yb2xlID09PSAnYWRtaW4nIHx8IHRoaXMuY3VycmVudFVzZXIucm9sZSA9PT0gJ21hbmFnZXInKTtcbiAgfVxuXG4gIGlzQWRtaW4oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFVzZXIgJiYgKHRoaXMuY3VycmVudFVzZXIucm9sZSA9PT0gJ2FkbWluJyk7XG4gIH1cbn1cbiJdfQ==